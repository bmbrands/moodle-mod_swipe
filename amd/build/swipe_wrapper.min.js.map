{"version":3,"sources":["../src/swipe_wrapper.js"],"names":["define","$","CustomEvents","Notification","Ajax","transform_unused","jTinder","textFit","SELECTORS","WRAPPER","LIKE","DISLIKE","VIEW_INFO","CLOSE_INFO","ACTION_CONTAINER","INFO_CONTAINER","CARD_IMAGE","CARD_VIDEO","FEEDBACK_CONTAINER","FEEDBACK_INPUT","FEEDBACK_SEND","FEEDBACK_THANKS","FEEDBACK_TEXT","TYPE","IMAGE","VIDEO","TEXT","storeLike","itemid","like","promise","call","methodname","args","fail","exception","storeFeedback","swipeid","feedback","getCardId","root","container","find","attr","getCard","cardid","card","showCardInfo","cardinfo","status","css","registerEventListeners","events","activate","on","e","data","originalEvent","preventDefault","fbContainer","fbInput","fbText","fbThanks","val","then","addClass","removeClass","nextCardActions","length","type","iframe","video","preloadid","preloadCard","cardimage","init","document","getElementsByClassName","multiLine","onDislike","onLike","animationRevertSpeed","animationSpeed","threshold","likeSelector","dislikeSelector"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Thin wrapper allowing us to load the lightbox.js\n *\n * @package    mod_swipe\n * @copyright  2020 Cambridge Assessment International Education\n * @author     Bas Brands <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(\n[\n    'jquery',\n    'core/custom_interaction_events',\n    'core/notification',\n    'core/ajax',\n    'mod_swipe/transform',\n    'mod_swipe/tinder',\n    'mod_swipe/textFit'\n],\nfunction(\n    $,\n    CustomEvents,\n    Notification,\n    Ajax,\n    transform_unused,\n    jTinder,\n    textFit\n) {\n    var SELECTORS = {\n        WRAPPER: '[data-region=\"swipe-wrapper\"]',\n        LIKE: '[data-action=\"like\"]',\n        DISLIKE: '[data-action=\"dislike\"]',\n        VIEW_INFO: '[data-action=\"info\"]',\n        CLOSE_INFO: '[data-action=\"close-info\"]',\n        ACTION_CONTAINER: '[data-region=\"cardactions\"]',\n        INFO_CONTAINER: '[data-region=\"card-info\"]',\n        CARD_IMAGE: '[data-region=\"card-image\"]',\n        CARD_VIDEO: '[data-region=\"card-video\"]',\n        FEEDBACK_CONTAINER: '[data-region=\"feedback-container\"]',\n        FEEDBACK_INPUT: '[data-region=\"feedback-input\"]',\n        FEEDBACK_SEND: '[data-action=\"send-feedback\"]',\n        FEEDBACK_THANKS: '[data-region=\"feedback-thanks\"]',\n        FEEDBACK_TEXT: '[data-region=\"feedback-text\"]'\n    };\n\n    var TYPE = {\n        IMAGE: 1,\n        VIDEO: 2,\n        TEXT: 3\n    };\n\n    var storeLike = function(itemid, like) {\n        var args = {\n            itemid : itemid,\n            like: like\n        };\n        var request = {\n            methodname: 'mod_swipe_like',\n            args: args\n        };\n        var promise = Ajax.call([request])[0];\n        promise.fail(Notification.exception);\n\n        return promise;\n    };\n\n    var storeFeedback = function(swipeid, feedback) {\n        var args = {\n            swipeid : swipeid,\n            feedback: feedback\n        };\n        var request = {\n            methodname: 'mod_swipe_feedback',\n            args: args\n        };\n        var promise = Ajax.call([request])[0];\n        promise.fail(Notification.exception);\n        return promise;\n    };\n\n    var getCardId = function(root) {\n        var container = root.find(SELECTORS.ACTION_CONTAINER);\n        return container.attr('data-current-card');\n    };\n\n    var getCard = function(root, cardid) {\n        if (cardid) {\n            var card = root.find('[data-card-id=' + cardid + ']');\n            return card;\n        }\n    };\n\n    var showCardInfo = function(card) {\n        var cardinfo = card.find(SELECTORS.INFO_CONTAINER);\n        var status = cardinfo.attr('data-status');\n        if (status == 'closed') {\n            cardinfo.css('top', '0');\n            cardinfo.attr('data-status', 'open');\n        } else {\n            cardinfo.css('top', '-420px');\n            cardinfo.attr('data-status', 'closed');\n        }\n    };\n\n    /**\n     * Listen to and handle events for routing, showing and hiding the message drawer.\n     *\n     * @param {Object} root The message drawer container.\n     */\n    var registerEventListeners = function(root) {\n\n        CustomEvents.define(root, [CustomEvents.events.activate]);\n\n        root.on(CustomEvents.events.activate, SELECTORS.VIEW_INFO, function(e, data) {\n            var cardid = getCardId(root);\n            var card = getCard(root, cardid);\n            showCardInfo(card);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.CLOSE_INFO, function(e, data) {\n            var cardid = getCardId(root);\n            var card = getCard(root, cardid);\n            showCardInfo(card);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.LIKE, function(e, data) {\n            $(\"#tinderslide\").jTinder('like');\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.DISLIKE, function(e, data) {\n            $(\"#tinderslide\").jTinder('dislike');\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.FEEDBACK_SEND, function (e, data) {\n            var fbContainer = root.find(SELECTORS.FEEDBACK_CONTAINER);\n            var fbInput = fbContainer.find(SELECTORS.FEEDBACK_INPUT);\n            var fbText = fbContainer.find(SELECTORS.FEEDBACK_TEXT);\n            var fbThanks = fbContainer.find(SELECTORS.FEEDBACK_THANKS);\n            var swipeid = fbContainer.attr('data-swipeid');\n            var feedback = fbText.val();\n\n            storeFeedback(swipeid, feedback).then( function() {\n                fbInput.addClass('hidden');\n                fbThanks.removeClass('hidden');\n            });\n\n            data.originalEvent.preventDefault();\n        });\n    };\n\n    var nextCardActions = function(root, cardid) {\n\n        var card = getCard(root, cardid);\n        if (!card.length) {\n            return;\n        }\n        var type = card.attr('data-card-type');\n\n        // Stop video\n        if (type == TYPE.VIDEO) {\n            var iframe = card.find('iframe');\n            if ( iframe.length ) {\n                var video = iframe.attr('src');\n                iframe.attr('src', '');\n                iframe.attr('src', video);\n            }\n        }\n\n        // Prepare the next cards on the deck.\n        var preloadid = card.attr('data-preload');\n\n        if (card.attr('data-last')) {\n            root.find(SELECTORS.ACTION_CONTAINER).addClass('hidden');\n            root.find(SELECTORS.FEEDBACK_CONTAINER).removeClass('hidden');\n            root.find(SELECTORS.WRAPPER).addClass('hidden');\n        }\n\n        if (preloadid) {\n            var preloadCard = getCard(root, preloadid);\n\n            // Load card image\n            if (preloadCard.attr('data-card-type') == TYPE.IMAGE) {\n                var cardimage = preloadCard.attr('data-card-image');\n                preloadCard.find(SELECTORS.CARD_IMAGE).attr('style', 'background-image: url(' + cardimage + ')');\n            }\n\n            // Load card video\n            if (preloadCard.attr('data-card-type') == TYPE.VIDEO) {\n                var video = preloadCard.attr('data-card-video');\n                preloadCard.find(SELECTORS.CARD_VIDEO).attr('src', video);\n            }\n        }\n    };\n\n    /**\n     * @method\n     * @param {Object} options\n     */\n    var init = function(root) {\n        var root = $(root);\n        textFit(document.getElementsByClassName('innertext'), {multiLine: true});\n        $(\"#tinderslide\").jTinder({\n            // dislike callback\n            onDislike: function () {\n                // set the status text\n                var cardid = getCardId(root);\n                storeLike(cardid, false);\n                nextCardActions(root, cardid);\n            },\n            // like callback\n            onLike: function () {\n                var cardid = getCardId(root);\n                storeLike(cardid, true);\n                nextCardActions(root, cardid);\n            },\n            animationRevertSpeed: 200,\n            animationSpeed: 400,\n            threshold: 1,\n            likeSelector: '.like',\n            dislikeSelector: '.dislike'\n        });\n        registerEventListeners(root);\n    };\n\n    return {\n        init: init\n    };\n});\n"],"file":"swipe_wrapper.min.js"}